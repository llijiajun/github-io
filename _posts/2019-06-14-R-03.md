---
title: "基于Rstudio的展示模板创建和使用"
author: "冥郡"
date: "2019-06-14"
layout: post
categories: R
---

## 背景介绍

英语演讲课曾说，PPT只是辅助工具，更核心和本质的是演讲者的内容。作为排版困难者，尝试着探索了一些只关注内容的PPT写法，随着四年统计学习，R虽然已经快脱离我的常用语言名单，但利用Rstudio制作PPT的经验还是不希望就随着我的不用而消亡。故记录下一些改装模板的经验。本文适合会Rmarkdown，想自定义模板的人阅读。

## 从yaml说起

或许使用Rmarkdown的人有的甚至不知道什么是yaml，其实就是在生成模板时，三条横杠框住的参数设置，要学会自定义模板，首先要知道有什么可以改，才能下手，类似于学编程初期时，有的人总对编译链接生成机器代码那一段不屑一顾，但生成pdf、html、word等等，整个过程就类似于编译的过程。而yaml文件，则决定了使用什么参数编译。

```
---
title: "Untitled"
author: "author"
date: "2019年6月14日"
output: html_document
---
```

从最简单的生成一个普通html报告来说，看似这四行代码没什么好解释的，但可以使用什么参数却可以根据这四行代码推断出。其中最重要的一行是第四行，output:html_document，在我只会套用模板而没深入研究时，无法注意到这行代码的重要性。这行代码的正确使用方式是在R中引入rmarkdown包后，输入?html_document，之后新世界便打开了，所谓html_document后加的参数根本就是这个函数的参数。rmarkdown生成报告的命令可以在Rmarkdown console界面中看到，如下：

```
C:/PROGRA~2/Pandoc/pandoc" +RTS -K512m -RTS example.utf8.md --to html4 --from markdown+autolink_bare_uris+ascii_identifiers+tex_math_single_backslash+smart --output example.html --email-obfuscation none --self-contained --standalone --section-divs --template "C:\Users\m1881\Documents\R\win-library\3.5\rmarkdown\rmd\h\default.html" --no-highlight --variable highlightjs=1 --variable "theme:bootstrap" --include-in-header "C:\Users\m1881\AppData\Local\Temp\Rtmpc5GI7B\rmarkdown-str37d03d181e60.html" --mathjax --variable "mathjax-url:https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML
```

虽然看起来一样没有很多信息，对某些同学来说，也许就是一堆乱码，但实际上熟悉编程的小朋友都知道，这些参数指定着编译的过程和各种参数。knit怎么写我不清楚，但我能读出来的是，从rmd生成的md文件，被pandoc转换为了各种其他的文件，中间有的文件是库的引用，有的文件是模板的引用。

而更改模板的下手点也就在--template这里，对于“高手”来说，重新写一个包，也就是重新写一个html_document也就更改了模板的内容这类的东西，但如果不想重新写包的话，毫无疑问，改模板只需要把默认模板的位置找到，然后改其中的css渲染情况即可。

对于最初级的同学，不妨根据html_document的帮助参数toc改一下，会发现可以多一个目录，这也是最基础的修改报告PPT的方式，当然完全做不到自定义。

## Prettydoc的千篇一律

从大二第一次从李某师兄处看到prettydoc的样子，发展到现在是个统计学院稍微高年级的人都会的rmarkdown模板，不得不说prettydoc还是有其可爱之处的。

首先是下载R包prettydoc,改模板当然还是从yaml和帮助能说明的比较清楚。

```
---
title: "Your Document Title"
author: "Document Author"
date: "`r Sys.Date()`"
output:
  prettydoc::html_pretty:
    theme: architect
    highlight: github
---
```

这里的theme可以换五种形式的主题，五种主题的名字从何而来，也是从编译过程可以看出来


```
"C:/PROGRA~2/Pandoc/pandoc" +RTS -K512m -RTS Untitled.utf8.md --to html4 --from markdown+autolink_bare_uris+ascii_identifiers+tex_math_single_backslash+smart --output Untitled.html --email-obfuscation none --self-contained --standalone --section-divs --template "C:/Users/m1881/Documents/R/win-library/3.5/prettydoc/resources/templates/architect.html" --highlight-style pygments --mathjax --variable "mathjax-url:https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" --css Untitled_files/style.css
```

这里编译使用模板的路径为"C:/Users/m1881/Documents/R/win-library/3.5/prettydoc/resources/templates/architect.html"，顺藤摸瓜，翻到这个目录下，看到的五个html的名字就是可以定制的模板名。探索到这一步，稍微懂一点html的同学都应该明白了，所谓改模板就把这个html复制一份，顺便把css也复制一份，然后直接改颜色参数，有能力的做点植入和选择保护，很容易就可以定制模板了。

或许我水平真的一般，平常也没考虑过这些问题，当我探索到这一步时，已经是学R的两年后了，写这一文章的目的，一定程度上也是希望读文章的人能少走弯路。

基于Cayman的模板，我稍加修改，定义出了homework、homeworkdark两个模板，其特点除了稍微修改了颜色，还让html模板不可复制粘贴，这样可以在别人抄作业的时候，可以自己打一下代码，而不是完全复制粘贴，仔细看的话，还加了水印，加水印防粘贴的代码网上很多，这里不作详解，效果图如下：
![]({{site.baseurl}}/images/homework.png)
![]({{site.baseurl}}/images/homeworkdark.png)

## rticle

在两年前记得有人问我pdf生成怎么老是出错，老是有问题。其实我也没有完全探索明白，但有个很好用的R包，rticle。这个包中有很多模板，其中最容易运行起来的是ctex这个模板，很多时候bug甚至都不在R，而是在于latex本身，出于沉迷Rmarkdown的探索，我并不是很会写latex。使用时大部分情况下也是网上抄代码。探索自己到底在使用那个latex编译，最重要的方式也是看console的命令。从命令中，很容易就可以抓取到模板的位置，如下：

```
"C:/PROGRA~2/Pandoc/pandoc" +RTS -K512m -RTS 00.utf8.md --to latex --from markdown+autolink_bare_uris+ascii_identifiers+tex_math_single_backslash --output 00.tex --table-of-contents --toc-depth 2 --template "C:\Users\m1881\Documents\R\win-library\3.5\rticles\rmarkdown\templates\ctex\resources\default.latex" --number-sections --highlight-style tango --pdf-engine xelatex 
```

从这里可以看出每个模板所对应的位置，之后的--pdf-engine也就表明了所用的latex引擎，具体使用latex的引擎目录则要看Rstudio的配置。

困扰大多数人，不用Rmarkdown写pdf的根本原因有一定程度上是由于这个包的其他模板不支持中文。解决的思路很简单，就像其他的latex一样，只需要在模板中添加一样的latex支持即可，但是运行时依然可能出问题，这些bug并不是由Rmarkdown导致的，而很有可能是因为latex没有下载所引用模板的库。在Rstudio的角度是没有支持latex的下载的，但在texstudio中支持，所以每当我需要某个模板，还需要中文时，我的策略是:

- 更改所需要的模板tex文件，添加需要的包（除了添加中文支持，添加算法模块的模板也是可以的）
- 利用Rstudio生成中间的latex文件，XX.tex
- 利用texstudio编译tex文件，过程中会弹出是否安装新包的命令，点击安装即可
- 在texstudio中能生成pdf之后，在Rstudio中自然也可以了

#### PS. 必须确定的一点是Rstudio操作的latex和texstudio操作的latex一定要是同一个，下载太多的tex会使人分不清引擎

有人觉得使用rticle写报告很没有必要，那其实看这篇文章也没有什么必要，从我角度出发，也就是改完一次模板以后，什么时候来报告都能不去考虑版式，其实也是latex的理念。

## remarkjs

谈到remark.js，必定要谈的是谢大大写的写轮眼包。起初知道可以用Rstudio写好看的ppt也是从这里开始的。我曾经用两个周末探索了一下这个包，整体来说满足了普通展示PPT的所有要素。在这里我并不是很想说去更改这个包的模板，一方面是麻烦，且没有必要，另一方面是这个包其实已经含有很多扩展。问题只是在于如何使用。理解我之前所说的，阅读yaml文件就能做到当时我所没注意到的一件事，即更改主题。起初我并没有注意到写轮眼有着许多的自定义主题，于是自己写了一个CSS，甚至在一次讲座上把css改得特别复杂，可以加logo、横条色等，但实际对于一般人使用来说，换主题只需要知道主题名字即可。方法还是阅读yaml的帮助，也就是xaringan::moon_reader,很容易发现在css定义里说明了换主题可以根据xaringan:::list_css()的结果更改，names(xaringan:::list_css())可以看到可以更改的主题和字体，不看名字看整个结果的路径则可以看到CSS文件所放置的位置，换句话说，增加新主题也就是加个css的事。当我再回顾谢大大的博客时发现，其实早在2017年，他就建议大家可以提交更新主题到他的github下，之后下包自然可以自动更新。我估计并没有很多有闲心的人会去专门设计一款主题，若是有人大主题的请回复我，也许xaringan在我PPT名单中会排位更往前一点。

特别想说的一点是，利用网页类型的PPT，用rmarkdown书写是可以直接添加html标签的。出于这个优势，往PPT中加歌曲、下拉表单也就变成了一件很容易的事。唯一的缺憾是，在rmd中，书写html代码一般不会有问题，但不能插入js代码。js的嵌入可以在整个rstudio编译完成之后再进行添加，稍微需要注意的是，应该提前保存代码，或者是单独写js文件，添加引用。在每一次Rstudio重新编译PPT的过程中，代码必不可免的会被重写和覆盖，这个添加js的过程也就需要重新完成。

xaringan虽然好，但依然没有达到心目中，不再需要额外添加代码或者是排版动作就能构造清爽的PPT，一定程度上是这个包自身的局限性。这里不去详解完整的怎么更改主题，嵌入歌曲、嵌入下拉表单和加logo的过程，限于文章不宜太长，或许未来能有一个完整的梳理，取决于这条路是否在未来还有可行性，制作一个完整而有各种功能的xaringa PPT通常也可能耗费我一晚的时间。

总的说来，入门学习xaringa的最佳手段是直接修改谢大大的PPT模板。

## revealjs

说到remark.js的最无奈的问题莫过于当内容过长时，无法下拉，而是只能切开成多页PPT。在一年前，在reveal.js我依旧不能解决这个问题。但在一次偶然回顾中发现，
reveal.js似乎是更新了，或者是之前没注意到，某页的背景可以上下拉动，这也就是说在Rmarkdown的reveal.js一样可以克服这个问题。其原理是在网页中嵌入框架，利用框架可以接入子html，而子html可以上下拖动，由于Rmarkdown中引用的是reveal.js的js文件，也就说明在Rmarkdown中嵌入相应的标签代码，js自然会完成渲染。此外，我突发奇想，可以嵌入可以下拉的网页，自然也可以嵌入PDF，在展示PPT中嵌入论文或者是bearmer的pdf也可以得到实现，在给他人展示时，假使需要使用论文中的结果，直接引用论文或别人的结果可是再方便不过了。

或许我唠叨的这一切除了我以外没人看懂在说什么，但具体效果可以参照我github中frSVD，为了在R会中做展示的PPT，再阅读对应的Rmarkdown文件，对这个流程就比较清楚了。

reveal.js区别于remark.js而吸引我的是，同样是html类型PPT，它的主题设置和转场效果也许都更加酷炫。

